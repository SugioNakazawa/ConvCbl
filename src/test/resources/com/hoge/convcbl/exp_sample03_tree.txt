PROCEDURE DIVISION
00-SAMPLE03 SECTION
PERFORM 10-INIT
10-INIT SECTION
OPEN INPUT IN01-FILE
OPEN OUTPUT OT01-FILE
10-INIT-EXIT
EXIT
PERFORM UNTIL ( KEY-NEW = HIGH-VALUE )
PERFORM 20-INIT
20-INIT SECTION
MOVE ZERO TO CTR-O1-PAGE
MOVE ZERO TO SUM-FIN-AAA001 SUM-FIN-BBB001 SUM-FIN-CCC001
20-INIT-EXIT
EXIT
PERFORM UNTIL ( KEY-NEW = HIGH-VALUE )
PERFORM 30-INIT
30-INIT SECTION
MOVE CNM-O1-LINE-MAX TO CTR-O1-LINE
MOVE ZERO TO SUM-TOT-AAA001 SUM-TOT-BBB001 SUM-TOT-CCC001
MOVE KEY-NEW TO KEY-OLD
30-INIT-EXIT
EXIT
PERFORM UNTIL ( KEY-NEW-XXX001 NOT = KEY-OLD-XXX001 )
PERFORM 40-MAIN END-PERFORM
40-MAIN SECTION
IF CTR-O1-LINE + 1 > CNM-O1-LINE-MAX
PERFORM 99-NEWPAGE END-IF
99-NEWPAGE SECTION
MOVE ZERO TO CTR-O1-LINE
COMPUTE CTR-O1-PAGE = CTR-O1-PAGE + 1
MOVE CTR-O1-PAGE TO O1-PAGE
MOVE SPACE TO O1-REC
WRITE O1-REC AFTER PAGE
WRITE O1-REC FROM O1-HEAD1 AFTER 2
WRITE O1-REC FROM O1-HEAD2 AFTER 2
WRITE O1-REC FROM O1-HEAD31 AFTER 2
WRITE O1-REC FROM O1-HEAD32 AFTER 1
COMPUTE CTR-O1-LINE = CTR-O1-LINE + 8
99-NEWPAGE-EXIT
EXIT
WRITE O1-REC FROM O1-MEISAI1 AFTER 1
COMPUTE CTR-O1-LINE = CTR-O1-LINE + 1
COMPUTE SUM-TOT-AAA001 = SUM-TOT-AAA001 + I1-AAA001
COMPUTE SUM-TOT-BBB001 = SUM-TOT-BBB001 + I1-BBB001
COMPUTE SUM-TOT-CCC001 = SUM-TOT-CCC001 + I1-CCC001
40-MAIN-EXIT
EXIT
PERFORM 50-END END-PERFORM
50-END SECTION
MOVE SUM-TOT-AAA001 TO O1-SUM-TOT-AAA001
MOVE SUM-TOT-BBB001 TO O1-SUM-TOT-BBB001
MOVE SUM-TOT-CCC001 TO O1-SUM-TOT-CCC001
IF CTR-O1-LINE + 1 > CNM-O1-LINE-MAX
PERFORM 99-NEWPAGE END-IF
99-NEWPAGE SECTION
MOVE ZERO TO CTR-O1-LINE
COMPUTE CTR-O1-PAGE = CTR-O1-PAGE + 1
MOVE CTR-O1-PAGE TO O1-PAGE
MOVE SPACE TO O1-REC
WRITE O1-REC AFTER PAGE
WRITE O1-REC FROM O1-HEAD1 AFTER 2
WRITE O1-REC FROM O1-HEAD2 AFTER 2
WRITE O1-REC FROM O1-HEAD31 AFTER 2
WRITE O1-REC FROM O1-HEAD32 AFTER 1
COMPUTE CTR-O1-LINE = CTR-O1-LINE + 8
99-NEWPAGE-EXIT
EXIT
WRITE O1-REC FROM O1-MEISAI2 AFTER 1
COMPUTE CTR-O1-LINE = CTR-O1-LINE + 1
COMPUTE SUM-FIN-AAA001 = SUM-FIN-AAA001 + SUM-TOT-AAA001
COMPUTE SUM-FIN-BBB001 = SUM-FIN-BBB001 + SUM-TOT-BBB001
COMPUTE SUM-FIN-CCC001 = SUM-FIN-CCC001 + SUM-TOT-CCC001
50-END-EXIT
EXIT
PERFORM 60-END END-PERFORM
60-END SECTION
MOVE SUM-FIN-AAA001 TO O1-SUM-FIN-AAA001
MOVE SUM-FIN-BBB001 TO O1-SUM-FIN-BBB001
MOVE SUM-FIN-CCC001 TO O1-SUM-FIN-CCC001
IF CTR-O1-LINE + 1 > CNM-O1-LINE-MAX
PERFORM 99-NEWPAGE END-IF
99-NEWPAGE SECTION
MOVE ZERO TO CTR-O1-LINE
COMPUTE CTR-O1-PAGE = CTR-O1-PAGE + 1
MOVE CTR-O1-PAGE TO O1-PAGE
MOVE SPACE TO O1-REC
WRITE O1-REC AFTER PAGE
WRITE O1-REC FROM O1-HEAD1 AFTER 2
WRITE O1-REC FROM O1-HEAD2 AFTER 2
WRITE O1-REC FROM O1-HEAD31 AFTER 2
WRITE O1-REC FROM O1-HEAD32 AFTER 1
COMPUTE CTR-O1-LINE = CTR-O1-LINE + 8
99-NEWPAGE-EXIT
EXIT
WRITE O1-REC FROM O1-MEISAI3 AFTER 1
60-END-EXIT
EXIT
PERFORM 70-END
70-END SECTION
CLOSE IN01-FILE OT01-FILE
70-END-EXIT
EXIT
00-SAMPLE03-EXIT
EXIT PROGRAM
